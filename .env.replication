# PostgreSQL 복제 환경 변수 설정
# 10,000+ 동시 사용자를 위한 읽기 복제본 구성

# 마스터 데이터베이스 (쓰기 전용)
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/blee_cms?schema=public"

# 읽기 복제본 1
DATABASE_REPLICA_1_URL="postgresql://postgres:postgres@localhost:5433/blee_cms?schema=public"
DATABASE_REPLICA_1_LIMIT=50
DATABASE_REPLICA_1_WEIGHT=1

# 읽기 복제본 2
DATABASE_REPLICA_2_URL="postgresql://postgres:postgres@localhost:5434/blee_cms?schema=public"
DATABASE_REPLICA_2_LIMIT=50
DATABASE_REPLICA_2_WEIGHT=1

# 읽기 복제본 3 (옵션)
# DATABASE_REPLICA_3_URL="postgresql://postgres:postgres@localhost:5435/blee_cms?schema=public"
# DATABASE_REPLICA_3_LIMIT=50
# DATABASE_REPLICA_3_WEIGHT=1

# pgBouncer 설정
PGBOUNCER_ENABLED=true
PGBOUNCER_HOST=localhost
PGBOUNCER_PORT=6432
PGBOUNCER_DATABASE=blee_cms
PGBOUNCER_USER=postgres
PGBOUNCER_PASSWORD=postgres
PGBOUNCER_POOL_MODE=transaction
PGBOUNCER_MAX_CLIENTS=1000
PGBOUNCER_DEFAULT_POOL_SIZE=25

# HAProxy 로드 밸런서 (읽기 전용)
DATABASE_READ_URL="postgresql://postgres:postgres@localhost:5435/blee_cms?schema=public"

# 연결 풀 설정
DB_CONNECTION_LIMIT=100  # 마스터 연결 제한
DB_POOL_MIN=10
DB_POOL_MAX=100
DB_IDLE_TIMEOUT_MILLIS=30000
DB_CONNECTION_TIMEOUT_MILLIS=2000

# 복제 모니터링 설정
REPLICATION_MONITOR_ENABLED=true
REPLICATION_CHECK_INTERVAL=10000  # 10초
REPLICATION_MAX_LAG_BYTES=104857600  # 100MB
REPLICATION_MAX_LAG_SECONDS=60
REPLICATION_ALERT_THRESHOLD=52428800  # 50MB

# 쿼리 성능 설정
SLOW_QUERY_LOG_THRESHOLD=100  # 100ms 이상 쿼리 로깅
QUERY_TIMEOUT=30000  # 30초
STATEMENT_TIMEOUT=30000

# 자동 장애 조치
AUTO_FAILOVER_ENABLED=false  # 프로덕션에서 true로 설정
FAILOVER_MAX_LAG_BYTES=209715200  # 200MB
FAILOVER_GRACE_PERIOD=300  # 5분

# 백업 설정
BACKUP_ENABLED=false
BACKUP_SCHEDULE="0 2 * * *"  # 매일 새벽 2시
BACKUP_RETENTION_DAYS=7
BACKUP_PATH=/var/backups/postgresql

# 모니터링 알림
ALERT_WEBHOOK_URL=""  # Slack/Discord 웹훅 URL
ALERT_EMAIL=""  # 알림 이메일 주소